# 🎮 playo - AI-Powered Habit Tracking RPG

> Transform your daily habits into an epic adventure! Complete real-life tasks to level up your character, unlock challenges, and shape an AI-generated story that reflects YOUR progress.

[![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue.svg)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)](https://nodejs.org/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

## � What is playo?

**playo** is a revolutionary habit tracking RPG that combines:
- 📚 **Epic Story Arcs** - 10-chapter narratives with branching paths
- ✅ **Real Habit Tracking** - Your completed tasks power character growth
- ⚔️ **Combat Challenges** - Fight enemies when your stats are high enough
- 🎲 **Dynamic Storytelling** - AI generates chapters reflecting YOUR actual progress
- 🏆 **Quest System** - Quests tied to real-life habit completion

**The Innovation:** Your morning workout doesn't just give you XP—it appears in the story as your character's training paying off in battle!

## ✨ Core Features

### 🤖 Hybrid Story System
- **Main Story Arcs**: Complete 10-chapter adventures generated by Google Gemini AI
- **Dynamic Chapters**: Story continues based on tasks you've completed
- **Branching Narratives**: Your choices matter and shape the plot
- **Quest Integration**: In-game quests tied to real habits (e.g., "Complete 3 workouts")
- **Challenge System**: Combat/puzzle encounters unlocked by stat requirements

### 📊 Habit Management
- **Daily Tasks**: Track recurring habits with streak counting
- **Habits**: Build consistency with intelligent reminders
- **To-Dos**: One-time tasks with priorities
- **Difficulty Levels**: EASY, MEDIUM, HARD tasks for varied XP
- **Categories**: Fitness, Learning, Wellness, Productivity, etc.

### 🏆 Character Progression
- **Level System**: Gain XP from completed tasks
- **6 Core Stats**: Strength, Wisdom, Agility, Endurance, Luck, Charisma
- **Stat Growth**: Different tasks boost different stats
- **Equipment**: Unlock items through story progression
- **Inventory System**: Collect loot from challenges

### ⚔️ Combat & Challenges
- **Stat-Based Combat**: STR/AGI/END/LUCK determine battle outcomes
- **AI Narratives**: Exciting battle descriptions for every encounter
- **Enemy Variety**: Different enemies with unique abilities
- **Difficulty Tiers**: EASY → MEDIUM → HARD → EPIC challenges
- **Rewards**: XP, gold, equipment, and story progression

## 🛠 Technology Stack

### Backend
- **Runtime**: Node.js 18+ with TypeScript 5.0
- **Framework**: Express.js with async/await
- **Database**: SQLite (dev) / PostgreSQL (prod) via Prisma ORM
- **Authentication**: JWT with bcrypt password hashing
- **AI Service**: Google Gemini 1.5 Flash for story generation

### Architecture
- RESTful API design
- Service layer pattern for business logic
- Prisma for type-safe database access
- Rate limiting & retry logic for AI API
- Comprehensive error handling

## 🚀 Quick Start

### Prerequisites

- **Node.js** 18+ LTS
- **npm** 8+
- **Google Gemini API Key** (get from [Google AI Studio](https://makersuite.google.com/app/apikey))

### Installation (5 minutes)

```bash
# 1. Clone the repository
git clone https://github.com/islamborghini/playo.git
cd playo

# 2. Install dependencies
npm install

# 3. Set up environment variables
cp .env.example .env
# Add your GEMINI_API_KEY to .env

# 4. Set up database
npx prisma migrate dev

# 5. Seed demo data
npx tsx prisma/seed.ts

# 6. Start server
npm run dev
```

**Server runs on:** `http://localhost:3000`

### First Steps

```bash
# 1. Login with demo account
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "demo@example.com", "password": "Demo@123456"}'

# 2. Create your story arc
curl -X POST http://localhost:3000/api/ai/story/arc/create \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "characterName": "Aria",
    "characterLevel": 1,
    "characterClass": "Warrior"
  }'
```

**Read your epic opening chapter!** 🎉

📖 **Full Tutorial**: See [Quick Start Guide](docs/QUICK_START.md)

## 📁 Project Structure

```
src/
├── controllers/     # Express route controllers
├── services/        # Business logic services
├── models/          # Data models and schemas
├── routes/          # API route definitions
├── middleware/      # Express middleware
├── utils/           # Utility functions
└── types/           # TypeScript type definitions
```

## 🔧 Available Scripts

- `npm run dev` - Start development server with hot reload
- `npm run build` - Build for production
- `npm start` - Start production server
- `npm run lint` - Run ESLint
- `npm run lint:fix` - Fix ESLint issues
- `npm run format` - Format code with Prettier
- `npm run format:check` - Check code formatting
- `npm test` - Run tests
- `npm run test:watch` - Run tests in watch mode
- `npm run test:coverage` - Generate test coverage report

## 🎯 How It Works

### The Gameplay Loop

```
1. 📖 Create Story Arc
   Generate 10 chapters with quests & challenges
   ↓
2. ✅ Complete Real Tasks
   Morning workout, reading, meditation, etc.
   ↓
3. 📈 Gain Stats & XP
   Fitness tasks → Strength | Learning → Wisdom
   ↓
4. 📚 Generate Next Chapter
   Story reflects YOUR actual accomplishments
   ↓
5. ⚔️ Unlock Challenges
   When stats meet requirements
   ↓
6. 🎲 Attempt Combat
   Stat-based battle with AI narrative
   ↓
7. 🏆 Win Rewards
   XP, gold, equipment, story progression
   ↓
8. 🔄 Repeat!
```

### Real Example

**You complete:** "Morning Workout" (7-day streak)

**In the game:**
- Character gains +2 Strength, +1 Endurance
- Levels up: 1 → 2
- Unlocks: "Forest Trial" challenge

**Next chapter reads:**
> "Your dedication to morning training has paid off. Aria's muscles are toned, her reflexes sharp. The forest path ahead seems less daunting now..."

**Your real habits literally shape the story!** ✨

## 📡 API Endpoints

### 🔐 Authentication
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/auth/register` | Create new account |
| POST | `/api/auth/login` | Login & get JWT |
| POST | `/api/auth/refresh` | Refresh access token |

### 🎮 Hybrid Story System
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/ai/story/arc/create` | Generate 10-chapter story |
| POST | `/api/ai/story/chapter/next` | Continue story with progress |
| POST | `/api/ai/challenge/check` | Check if ready for challenge |
| POST | `/api/ai/challenge/attempt` | Attempt combat & get narrative |
| GET | `/api/ai/story/current` | Get active story arc |

### ✅ Task Management
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/tasks` | Get all user tasks |
| POST | `/api/tasks` | Create new task |
| PUT | `/api/tasks/:id` | Update task |
| DELETE | `/api/tasks/:id` | Delete task |
| POST | `/api/tasks/:id/complete` | Mark task complete |

### 🎒 Inventory & Items
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/inventory` | Get character inventory |
| POST | `/api/inventory/equip/:itemId` | Equip item |
| POST | `/api/inventory/unequip/:itemId` | Unequip item |

### 🔍 Utility
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/ai/health` | Check Gemini AI status |
| GET | `/api/ai/rate-limit` | Check API rate limits |

📚 **Full API Docs**: Import [Postman Collection](postman/hybrid-story-system.postman_collection.json)

## 📁 Project Structure

```
playo/
├── src/
│   ├── controllers/        # Route handlers
│   ├── services/           # Business logic
│   │   ├── geminiService.ts      # AI story generation
│   │   ├── inventoryService.ts   # Item management
│   │   ├── streakService.ts      # Streak tracking
│   │   └── xpCalculator.ts       # XP & level logic
│   ├── routes/             # API endpoints
│   │   ├── ai.ts                 # Story & challenge routes
│   │   ├── auth.ts               # Authentication
│   │   ├── tasks.ts              # Task management
│   │   └── inventory.ts          # Inventory routes
│   ├── middleware/         # Auth, validation, error handling
│   ├── types/              # TypeScript definitions
│   │   └── gemini.ts             # Story system types
│   └── utils/              # Helper functions
├── prisma/
│   ├── schema.prisma       # Database schema
│   ├── migrations/         # Database versions
│   └── seed.ts             # Demo data
├── docs/                   # Documentation
└── postman/                # API collections
```

## 🧪 Available Scripts

```bash
# Development
npm run dev          # Start dev server with hot reload
npm run build        # Build for production
npm start            # Start production server

# Database
npx prisma migrate dev       # Create & apply migration
npx prisma studio            # Open database GUI
npx tsx prisma/seed.ts       # Seed demo data

# Code Quality
npm run lint         # Run ESLint
npm run lint:fix     # Fix ESLint issues
npm run format       # Format with Prettier
npm test             # Run tests
npm run test:coverage # Generate coverage report

# Utilities
npm run clean        # Remove build artifacts
```

## 🌟 Feature Status

### ✅ Completed (v1.0)
- [x] JWT Authentication with refresh tokens
- [x] Task Management (CRUD + completion)
- [x] Character Progression (XP, levels, stats)
- [x] Inventory System (equipment, items)
- [x] Streak Tracking with bonuses
- [x] Google Gemini AI Integration
- [x] Hybrid Story System (10-chapter arcs)
- [x] Quest System tied to real tasks
- [x] Combat Challenges with stat requirements
- [x] Dynamic Chapter Generation
- [x] AI Battle Narratives
- [x] Rate Limiting & Retry Logic
- [x] Comprehensive Documentation
- [x] Postman Collections

### 🚧 In Progress
- [ ] Persistent story state in database
- [ ] Real-time task → stat sync
- [ ] Web frontend (React)
- [ ] Mobile app (React Native)

### 🔮 Planned (v2.0)
- [ ] Multiplayer story arcs
- [ ] Achievement system
- [ ] Daily/weekly challenges
- [ ] Leaderboards
- [ ] Guild/party system
- [ ] Voice narration
- [ ] AI-generated story illustrations
- [ ] Social features (friends, sharing)

## ⚙️ Configuration

### Environment Variables

Copy `.env.example` to `.env`:

```bash
# Server
NODE_ENV=development
PORT=3000

# Database (SQLite for dev, PostgreSQL for prod)
DATABASE_URL="file:./dev.db"

# JWT Authentication (Generate secure keys!)
JWT_SECRET=your_super_secret_jwt_key_change_this
JWT_REFRESH_SECRET=your_super_secret_refresh_key_change_this
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d

# Google Gemini AI
GEMINI_API_KEY=your_gemini_api_key_here

# Rate Limits (optional, defaults shown)
RATE_LIMIT_MAX_REQUESTS_PER_MINUTE=15
RATE_LIMIT_MAX_REQUESTS_PER_DAY=1500
```

### Get Your Gemini API Key

1. Visit [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Click "Create API Key"
3. Copy and paste into `.env`
4. Free tier includes: 15 requests/minute, 1500/day

### Database Setup

**Development (SQLite - no setup needed):**
```bash
npx prisma migrate dev
```

**Production (PostgreSQL):**
```bash
# Update .env with PostgreSQL connection string
DATABASE_URL="postgresql://user:password@localhost:5432/playo"
npx prisma migrate deploy
```

## 📚 Documentation

### Core Guides
- **[Quick Start](docs/QUICK_START.md)** - Get running in 5 minutes
- **[Hybrid Story System](docs/HYBRID_STORY_SYSTEM.md)** - Complete feature guide
- **[API Reference](docs/API_REFERENCE.md)** - All endpoints with examples

### Service Documentation
- **[Gemini AI Service](docs/GEMINI_AI_SERVICE.md)** - Story generation details
- **[Inventory System](docs/INVENTORY_SERVICE.md)** - Item management
- **[XP Calculator](docs/XP_CALCULATOR.md)** - Leveling mechanics
- **[Streak Service](docs/STREAK_SERVICE.md)** - Consistency tracking

### Development
- **[Implementation Summary](docs/IMPLEMENTATION_SUMMARY.md)** - Technical overview
- **[Postman Collection](postman/)** - Ready-to-use API requests
- **[Database Schema](prisma/schema.prisma)** - Full data model

## 🎨 Example Usage

### Create Epic Story Arc

```typescript
// POST /api/ai/story/arc/create
{
  "characterName": "Kaiden",
  "characterLevel": 1,
  "characterClass": "Mage",
  "theme": "Mystical Adventure",
  "setting": "Ancient Ruins",
  "plotFocus": "mystery"
}

// Response: 10 chapters + quests + challenges
// Read chapter 1's epic opening!
```

### Complete Real Tasks

```typescript
// Your actual habits:
✅ Morning workout (7-day streak)
✅ Read 30 minutes (14-day streak)
✅ Meditate 10 minutes

// Character gains:
+2 Strength, +1 Endurance, +2 Wisdom
Level up: 1 → 2
XP: 150
```

### Generate Next Chapter

```typescript
// POST /api/ai/story/chapter/next
{
  "characterState": {
    "characterName": "Kaiden",
    "level": 2,
    "stats": {"strength": 5, "wisdom": 8}
  },
  "recentProgress": [
    {"title": "Morning Workout", "streakCount": 7},
    {"title": "Reading", "streakCount": 14}
  ]
}

// Response: AI-generated chapter mentioning your training!
// "Kaiden's weeks of disciplined study and physical training
// have transformed him. The ancient texts now make sense..."
```

### Attempt Challenge

```typescript
// POST /api/ai/challenge/attempt
{
  "characterName": "Kaiden",
  "characterState": {
    "level": 2,
    "stats": {"strength": 5, "wisdom": 8, "agility": 6}
  },
  "challenge": {
    "enemy": {
      "name": "Ancient Guardian",
      "level": 2,
      "stats": {"health": 80, "attack": 12}
    }
  }
}

// Response: Combat simulation + AI narrative
// "Victory! The Guardian falls. Kaiden's wisdom allowed
// him to exploit the creature's weakness..."
// Rewards: +200 XP, Ancient Tome, Guardian's Key
```

## 🔒 Security & Best Practices

### Rate Limiting
- **15 requests/minute** per user
- **1500 requests/day** per user
- Automatic backoff & retry on errors

### Authentication
- JWT with 7-day access tokens
- 30-day refresh tokens
- bcrypt password hashing (12 rounds)
- Secure HTTP headers

### Data Validation
- Request body validation
- Type checking with TypeScript
- SQL injection prevention (Prisma)
- XSS protection

## 🐛 Troubleshooting

### Common Issues

**"GEMINI_API_KEY is not configured"**
```bash
# Add to .env file:
GEMINI_API_KEY=your_actual_api_key
```

**"Rate limit exceeded"**
```bash
# Check your usage:
curl http://localhost:3000/api/ai/rate-limit \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**"Requirements not met" for challenge**
```bash
# Complete more tasks to level up!
# Check your stats and challenge requirements
```

**Database connection error**
```bash
# Reset database:
npx prisma migrate reset --force
npx tsx prisma/seed.ts
```

## 🤝 Contributing

We welcome contributions! Here's how:

1. **Fork** the repository
2. **Create** a feature branch
   ```bash
   git checkout -b feature/amazing-feature
   ```
3. **Commit** your changes
   ```bash
   git commit -m 'Add amazing feature'
   ```
4. **Push** to branch
   ```bash
   git push origin feature/amazing-feature
   ```
5. **Open** a Pull Request

### Code Standards
- ✅ TypeScript with strict mode
- ✅ ESLint + Prettier formatting
- ✅ Comprehensive error handling
- ✅ Unit tests for new features
- ✅ Clear commit messages
- ✅ Documentation updates

## 📄 License

This project is licensed under the **MIT License** - see [LICENSE](LICENSE) for details.

## 🙏 Acknowledgments

- **Google Gemini AI** - Powering story generation
- **Prisma** - Type-safe database ORM
- **Express.js** - Web framework
- **TypeScript** - Type safety

## 💬 Support & Community

- 🐛 **Bug Reports**: [Open an issue](https://github.com/islamborghini/playo/issues)
- 💡 **Feature Requests**: [Discussions](https://github.com/islamborghini/playo/discussions)
- 📧 **Contact**: islam@example.com
- 🌟 **Star this repo** if you find it useful!

## 🚀 Deployment

### Quick Deploy to Production

```bash
# 1. Build
npm run build

# 2. Set production env
export NODE_ENV=production
export DATABASE_URL="postgresql://..."

# 3. Run migrations
npx prisma migrate deploy

# 4. Start server
npm start
```

### Docker (Coming Soon)
```bash
docker build -t playo .
docker run -p 3000:3000 playo
```

---

<div align="center">

### **playo** - Where habits become adventures! 🗡️✨

**[Get Started](docs/QUICK_START.md)** • **[Documentation](docs/)** • **[API Reference](docs/API_REFERENCE.md)**

Made with ❤️ by [Islam Borghini](https://github.com/islamborghini)

</div>